<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Sprunky Horror — Full Version</title>
<style>
/* General Styles */
body,html{margin:0;padding:0;background:#0b0b0e;font-family:sans-serif;color:#eee;overflow-x:hidden;}
.wrap{display:grid;grid-template-columns:400px 1fr;gap:12px;max-width:1400px;margin:20px auto;}
.panel{background:linear-gradient(180deg,#111,#0a0a0f);border-radius:12px;padding:12px;box-shadow:0 10px 30px rgba(0,0,0,0.7);}
.left{display:flex;flex-direction:column;}
.right{display:flex;flex-direction:column;}
h1{margin:0;font-size:22px;}
.sub{color:#888;font-size:13px;margin-bottom:8px;}
button{padding:8px 12px;border-radius:10px;border:none;background:rgba(255,255,255,0.05);color:#ccc;cursor:pointer;font-weight:600;}
button.primary{background:linear-gradient(90deg,#ff6b8a,#ff364f);color:#fff;box-shadow:0 6px 20px rgba(255,80,40,0.15);}
input[type=range]{width:100%;margin:6px 0;}
.chars{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;overflow-y:auto;max-height:550px;}
.char{display:flex;gap:6px;align-items:center;padding:6px;border-radius:10px;background:rgba(255,255,255,0.02);cursor:pointer;border:1px solid rgba(255,255,255,0.02);}
.avatar{width:60px;height:60px;border-radius:12px;background:#222;display:flex;align-items:center;justify-content:center;font-weight:800;color:#fff;transition:transform .4s,box-shadow .4s;}
.avatar-active{transform:translateY(-4px) scale(1.05);box-shadow:0 6px 18px rgba(255,90,143,0.3);animation:beatPulse 0.8s infinite;}
@keyframes beatPulse{0%{transform:translateY(-4px) scale(1.02);}50%{transform:translateY(-4px) scale(1.08);}100%{transform:translateY(-4px) scale(1.02);}}
.stage{flex:1;border-radius:12px;background:linear-gradient(180deg,#071322,#031018);padding:12px;position:relative;overflow:hidden;border:1px solid rgba(255,255,255,0.03);}
.slots{display:flex;gap:8px;justify-content:center;margin-top:12px;}
.slot{width:100px;height:140px;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,0.01),rgba(0,0,0,0.02));display:flex;flex-direction:column;align-items:center;justify-content:flex-start;padding:6px;border:1px dashed rgba(255,255,255,0.03);transition:transform .18s;}
.slot.active{box-shadow:0 10px 40px rgba(255,90,143,0.25);transform:translateY(-4px);}
.slotTop{width:60px;height:60px;border-radius:10px;background:#081d25;display:flex;align-items:center;justify-content:center;color:#ccc;font-weight:700;margin-top:4px;}
.effectsLayer{pointer-events:none;position:absolute;inset:0;z-index:10;}
.ghost{position:absolute;inset:0;background:radial-gradient(circle at 50% 20%, rgba(255,255,255,0.02), transparent 15%);mix-blend-mode:screen;opacity:0;transition:opacity .6s;}
.ghost.on{opacity:1;}
.shake{animation:shake 0.5s;}
@keyframes shake{0%{transform:translateX(0);}25%{transform:translateX(-6px);}50%{transform:translateX(5px);}75%{transform:translateX(-3px);}100%{transform:translateX(0);}}
.meter{font-size:13px;color:#888;margin-left:auto;}
.comboList{margin-top:10px;color:#888;font-size:13px;}
@media(max-width:980px){.wrap{grid-template-columns:1fr;gap:8px;}.left{order:2;}.right{order:1;}}
</style>
</head>
<body>
<div class="wrap">
<div class="panel left">
<h1>Sprunky Horror — Full Version</h1>
<div class="sub">Click or drag/drop sounds onto characters. Combos trigger special horror effects.</div>
<div class="controls">
<button id="startBtn" class="primary">Start Audio</button>
<button id="stopBtn">Stop</button>
<button id="clearBtn">Clear All</button>
</div>
<label class="small">Tempo <span id="tempoRead">120 BPM</span></label>
<input id="tempo" type="range" min="80" max="160" value="120">
<div class="chars" id="charsArea"></div>
<div class="comboList" id="comboList"><b>Combos:</b> Try C1+C2+C5 for flash; C3+C4+C6 for ghost overlay; C7+C8 for whisper surge.</div>
</div>

<div class="panel right">
<div class="stage" id="stage">
<div style="display:flex;align-items:center;gap:10px;">
<div style="padding:4px 8px;background:linear-gradient(90deg,#0b2530,#06202b);border-radius:6px;">Stage</div>
<div class="meter" id="activeCount">Active: 0</div>
</div>
<div class="slots" id="slotsArea"></div>
<div class="effectsLayer">
<div id="ghostOverlay" class="ghost"></div>
<canvas id="flashCanvas" style="position:absolute;inset:0;pointer-events:none;"></canvas>
</div>
</div>
</div>
</div>

<script>
/* --- Audio Context --- */
let ctx=null,tempo=120;
const charsArea=document.getElementById('charsArea');
const slotsArea=document.getElementById('slotsArea');
const activeCountEl=document.getElementById('activeCount');
const ghostOverlay=document.getElementById('ghostOverlay');
const flashCanvas=document.getElementById('flashCanvas');
const flashCtx=flashCanvas.getContext('2d');

function ensureAudio(){if(!ctx) ctx=new (window.AudioContext||window.webkitAudioContext)(); if(ctx.state==='suspended') ctx.resume();}
function resizeCanvas(){flashCanvas.width=flashCanvas.clientWidth;flashCanvas.height=flashCanvas.clientHeight;}
window.addEventListener('resize',resizeCanvas);resizeCanvas();

/* --- Track / Sound Definitions --- */
const TRACKS=['drum','hat','snare','bass','pluck','vox','pad'];
const charCount=10;
let charActive=new Array(charCount).fill(false);
let charNodes=Array.from({length:charCount},()=>[]);

/* --- Build Character UI --- */
function buildUI(){
  const gradients=['linear-gradient(135deg,#ffb3b3,#ff5a8f)','linear-gradient(135deg,#baffc9,#4be87a)','linear-gradient(135deg,#b9d2ff,#4a8eff)',
  'linear-gradient(135deg,#f5b6ff,#e25cff)','linear-gradient(135deg,#9ff0ff,#3ad2d2)','linear-gradient(135deg,#ffe6a8,#ffb54f)',
  'linear-gradient(135deg,#d6ffb3,#77ff3a)','linear-gradient(135deg,#ff8cf0,#ff3abc)','linear-gradient(135deg,#ffb37c,#ff573f)','linear-gradient(135deg,#b3fffb,#3affd2)'];
  
  for(let i=0;i<charCount;i++){
    const charDiv=document.createElement('div');charDiv.className='char';charDiv.dataset.index=i;
    const avatar=document.createElement('div');avatar.className='avatar';avatar.style.background=gradients[i];avatar.textContent='C'+(i+1);
    charDiv.appendChild(avatar);
    charDiv.addEventListener('click',()=>toggleChar(i));
    charsArea.appendChild(charDiv);
    
    const slot=document.createElement('div');slot.className='slot';slot.dataset.index=i;
    const top=document.createElement('div');top.className='slotTop';top.textContent='Empty';
    slot.appendChild(top);slotsArea.appendChild(slot);
  }
}
buildUI();

/* --- Character Activation --- */
function toggleChar(idx){
  charActive[idx]=!charActive[idx];
  updateUI();
  if(charActive[idx]) playChar(idx); else stopChar(idx);
}

function updateUI(){
  document.querySelectorAll('.char .avatar').forEach((a,i)=>{if(charActive[i]) a.classList.add('avatar-active'); else a.classList.remove('avatar-active');});
  let activeCount=charActive.filter(b=>b).length;
  activeCountEl.textContent='Active: '+activeCount;
  
  // Combos
  if(charActive[0]&&charActive[1]&&charActive[4]) triggerFlash();
  if(charActive[2]&&charActive[3]&&charActive[5]) triggerGhost();
  if(charActive[6]&&charActive[7]) triggerWhisper();
}

/* --- Play / Stop Sounds --- */
function playChar(idx){
  ensureAudio();
  TRACKS.forEach(type=>{
    const buffer=generateAudioBuffer(type);
    const src=ctx.createBufferSource();
    src.buffer=buffer; src.loop=true; src.connect(ctx.destination); src.start();
    charNodes[idx].push(src);
  });
}

function stopChar(idx){
  charNodes[idx].forEach(n=>n.stop()); charNodes[idx]=[];
}

/* --- Effects --- */
function triggerGhost(){ghostOverlay.classList.add('on');setTimeout(()=>ghostOverlay.classList.remove('on'),1200);}
function triggerFlash(){flashCtx.fillStyle='rgba(255,255,255,0.4)';flashCtx.fillRect(0,0,flashCanvas.width,flashCanvas.height);setTimeout(()=>flashCtx.clearRect(0,0,flashCanvas.width,flashCanvas.height),150);}
function triggerWhisper(){console.log('Whisper surge triggered!');}

/* --- Simple Audio Generator --- */
function generateAudioBuffer(type){
  const sr=44100,dur=0.5,numSamples=sr*dur; const buffer=ctx.createBuffer(1,numSamples,sr);
  const data=buffer.getChannelData(0);
  let freq=220;
  if(type==='drum') freq=60; else if(type==='hat') freq=4000; else if(type==='snare') freq=180; else if(type==='bass') freq=110; else if(type==='pluck') freq=300; else if(type==='vox') freq=500; else if(type==='pad') freq=200;
  for(let i=0;i<numSamples;i++){data[i]=Math.sin(2*Math.PI*freq*i/sr)*0.3;}
  return buffer;
}

/* --- Event Listeners --- */
document.getElementById('startBtn').addEventListener('click',()=>{ensureAudio();});
document.getElementById('stopBtn').addEventListener('click',()=>{charActive.fill(false);updateUI(); charNodes.forEach((n,i)=>stopChar(i));});
document.getElementById('clearBtn').addEventListener('click',()=>{charActive.fill(false);updateUI(); charNodes.forEach((n,i)=>stopChar(i));});
document.getElementById('tempo').addEventListener('input',e=>{tempo=parseInt(e.target.value);document.getElementById('tempoRead').textContent=tempo+' BPM';});
</script>
</body>
</html>
